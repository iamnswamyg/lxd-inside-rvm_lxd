{%- set applications = pillar['ufconfig']['applications'] %}
# Transforms pillar ufconif.applications data to a structure suitable for ufrestart-webapp.sh

# servers:
#   <server>:
#     <worker>: <lbworker>

servers:
{%- for applicationKey, application in applications.items() %}
{%- if 'servers' in application %}
{%- for serverGroupKey, serverGroup in application['servers'].items() %}
{%- for webServer in serverGroup['web-servers'] %}
  - {{ webServer }}
{%- endfor %}
{%- endfor %}
{%- endif %}
{%- endfor %}

application-webservers:
{%- for applicationKey, application in applications.items() %}
  {{ applicationKey }}:
{%- if 'servers' in application %}
{%- for serverGroupKey, serverGroup in application['servers'].items() %}
    {{ serverGroupKey }}:
      {{ serverGroup['config'] }}:
{%- for webServer in serverGroup['web-servers-deploy'] | default(serverGroup['web-servers']) %}
        - {{ webServer }}
{%- endfor %}
{%- endfor %}
{%- endif %}
{%- endfor %}
